<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPB Live Dashboard - ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ä½œãƒ†ã‚¹ãƒˆç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 0.9em;
        }
        
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .control-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .cache-info {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }
        
        .cache-status {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .status-item {
            flex: 1;
            min-width: 200px;
        }
        
        .status-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }
        
        .process-monitor {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .process-monitor h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .log-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        
        .log-entry.info {
            border-left-color: #00ff00;
        }
        
        .log-entry.warning {
            border-left-color: #ffaa00;
            color: #ffaa00;
        }
        
        .log-entry.error {
            border-left-color: #ff0000;
            color: #ff0000;
        }
        
        .log-entry.success {
            border-left-color: #00ffff;
            color: #00ffff;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .data-display {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .data-display h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .game-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .game-date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .game-score {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .team-home {
            color: #667eea;
        }
        
        .team-away {
            color: #764ba2;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge.cache-hit {
            background: #4CAF50;
            color: white;
        }
        
        .badge.cache-miss {
            background: #ff9800;
            color: white;
        }
        
        .countdown {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>âš¾ NPB Live Dashboard</h1>
            <p>ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ä½œãƒ†ã‚¹ãƒˆç‰ˆ - Vercel Edge Cache ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</p>
            <p style="font-size: 0.8em; margin-top: 10px;">â€»ã“ã®ãƒšãƒ¼ã‚¸ã¯ä¼ç”»æ›¸ã®æŠ€è¡“è¦ä»¶ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ç°¡æ˜“ç‰ˆã§ã™</p>
        </div>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="control-panel">
            <h2>ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«</h2>
            
            <div class="cache-info">
                <h3 style="margin-bottom: 15px;">ğŸ“Š ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹</h3>
                <div class="cache-status">
                    <div class="status-item">
                        <strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™:</strong>
                        <span id="cacheExpiry">ãªã—</span>
                    </div>
                    <div class="status-item">
                        <strong>æœ€çµ‚å–å¾—æ—¥æ™‚:</strong>
                        <span id="lastFetch">ã¾ã å–å¾—ã—ã¦ã„ã¾ã›ã‚“</span>
                    </div>
                    <div class="status-item">
                        <strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡:</strong>
                        <span id="hitRate">0%</span>
                    </div>
                    <div class="status-item">
                        <strong>ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°:</strong>
                        <span id="requestCount">0å›</span>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button id="fetchBtn" onclick="fetchData()">
                    ğŸ”„ ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ10æœˆã®è©¦åˆçµæœï¼‰
                </button>
                <button onclick="clearCache()">
                    ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                </button>
                <button onclick="clearLogs()">
                    ğŸ“ ãƒ­ã‚°ã‚¯ãƒªã‚¢
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="cacheHits">0</div>
                    <div class="stat-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cacheMisses">0</div>
                    <div class="stat-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="scrapeCount">0</div>
                    <div class="stat-label">ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ</div>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼ -->
        <div class="process-monitor">
            <h2>ğŸ–¥ï¸ ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼ï¼ˆè£å´ã®å‹•ä½œï¼‰</h2>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">[SYSTEM] ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†</div>
                <div class="log-entry info">[READY] ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="data-display">
            <h2>ğŸ“… 2025å¹´10æœˆ è©¦åˆçµæœ</h2>
            <div id="dataContainer">
                <p style="color: #999; text-align: center; padding: 40px;">
                    ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ä¸Šã®ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
                </p>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let cacheData = null;
        let cacheExpiry = null;
        let lastFetchTime = null;
        let requestCount = 0;
        let cacheHits = 0;
        let cacheMisses = 0;
        let scrapeCount = 0;
        
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™ï¼ˆ3åˆ† = 180ç§’ = 180000ãƒŸãƒªç§’ï¼‰
        const CACHE_DURATION = 3 * 60 * 1000;
        
        // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é…å»¶ï¼ˆ5ç§’ï¼‰
        const SCRAPING_DELAY = 5000;

        // ãƒ­ã‚°è¿½åŠ é–¢æ•°
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div class="log-entry info">[SYSTEM] ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
        }

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
        function checkCache() {
            const now = Date.now();
            if (cacheData && cacheExpiry && now < cacheExpiry) {
                return true;
            }
            return false;
        }

        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
        async function showCountdown() {
            const dataContainer = document.getElementById('dataContainer');
            const totalSeconds = SCRAPING_DELAY / 1000;
            
            for (let i = totalSeconds; i > 0; i--) {
                dataContainer.innerHTML = `
                    <div class="spinner"></div>
                    <div class="countdown">ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é–‹å§‹ã¾ã§: ${i}ç§’</div>
                    <p style="text-align: center; color: #666; margin-top: 10px;">
                        ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ã®ãŸã‚æ„å›³çš„ãªé…å»¶ã‚’è¨­å®šã—ã¦ã„ã¾ã™
                    </p>
                `;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
        function updateProgress(percent, message) {
            const dataContainer = document.getElementById('dataContainer');
            dataContainer.innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percent}%">
                        ${message}
                    </div>
                </div>
            `;
        }

        // NPBã‚µã‚¤ãƒˆã‹ã‚‰å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        async function scrapeNPBData() {
            addLog('ğŸ“¡ NPBå…¬å¼ã‚µã‚¤ãƒˆã¸æ¥ç¶šä¸­...', 'info');
            updateProgress(10, 'æ¥ç¶šä¸­...');
            await new Promise(resolve => setTimeout(resolve, 500));

            addLog('ğŸ” HTMLãƒ‘ãƒ¼ã‚¹å‡¦ç†ã‚’é–‹å§‹', 'info');
            updateProgress(30, 'HTMLãƒ‘ãƒ¼ã‚¹ä¸­...');
            await new Promise(resolve => setTimeout(resolve, 800));

            addLog('âš™ï¸ Cheerioãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºä¸­...', 'info');
            updateProgress(50, 'ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºä¸­...');
            await new Promise(resolve => setTimeout(resolve, 800));

            addLog('ğŸ”„ JSONãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–å‡¦ç†ä¸­...', 'info');
            updateProgress(70, 'æ­£è¦åŒ–ä¸­...');
            await new Promise(resolve => setTimeout(resolve, 600));

            // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®NPBã‚µã‚¤ãƒˆã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ç°¡æ˜“ç‰ˆï¼‰
            const scrapedData = {
                month: '2025å¹´10æœˆ',
                games: [
                    {
                        date: '10æœˆ1æ—¥ï¼ˆæ°´ï¼‰',
                        matches: [
                            { home: 'å·¨äºº', away: 'ä¸­æ—¥', homeScore: 5, awayScore: 2, stadium: 'æ±äº¬ãƒ‰ãƒ¼ãƒ ' },
                            { home: 'DeNA', away: 'ãƒ¤ã‚¯ãƒ«ãƒˆ', homeScore: 9, awayScore: 6, stadium: 'æ¨ªæµœã‚¹ã‚¿ã‚¸ã‚¢ãƒ ' },
                            { home: 'ã‚ªãƒªãƒƒã‚¯ã‚¹', away: 'è¥¿æ­¦', homeScore: 10, awayScore: 5, stadium: 'äº¬ã‚»ãƒ©ãƒ‰ãƒ¼ãƒ å¤§é˜ª' }
                        ]
                    },
                    {
                        date: '10æœˆ2æ—¥ï¼ˆæœ¨ï¼‰',
                        matches: [
                            { home: 'é˜ªç¥', away: 'ãƒ¤ã‚¯ãƒ«ãƒˆ', homeScore: 6, awayScore: 2, stadium: 'ç”²å­åœ’' },
                            { home: 'ã‚ªãƒªãƒƒã‚¯ã‚¹', away: 'è¥¿æ­¦', homeScore: 5, awayScore: 6, stadium: 'äº¬ã‚»ãƒ©ãƒ‰ãƒ¼ãƒ å¤§é˜ª' }
                        ]
                    },
                    {
                        date: '10æœˆ3æ—¥ï¼ˆé‡‘ï¼‰',
                        matches: [
                            { home: 'åºƒå³¶', away: 'ãƒ¤ã‚¯ãƒ«ãƒˆ', homeScore: 1, awayScore: 6, stadium: 'MAZDA Zoom-Zoom ã‚¹ã‚¿ã‚¸ã‚¢ãƒ åºƒå³¶' },
                            { home: 'æ¥½å¤©', away: 'è¥¿æ­¦', homeScore: 7, awayScore: 6, stadium: 'æ¥½å¤©ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ãƒ¼ã‚¯å®®åŸ' },
                            { home: 'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯', away: 'ã‚ªãƒªãƒƒã‚¯ã‚¹', homeScore: 10, awayScore: 2, stadium: 'PayPayãƒ‰ãƒ¼ãƒ ' }
                        ]
                    },
                    {
                        date: '10æœˆ11æ—¥ï¼ˆåœŸï¼‰ - ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸',
                        matches: [
                            { home: 'DeNA', away: 'å·¨äºº', homeScore: 6, awayScore: 2, stadium: 'æ¨ªæµœã‚¹ã‚¿ã‚¸ã‚¢ãƒ ', type: 'CS' },
                            { home: 'æ—¥æœ¬ãƒãƒ ', away: 'ã‚ªãƒªãƒƒã‚¯ã‚¹', homeScore: 2, awayScore: 0, stadium: 'ã‚¨ã‚¹ã‚³ãƒ³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰HOKKAIDO', type: 'CS' }
                        ]
                    },
                    {
                        date: '10æœˆ25æ—¥ï¼ˆåœŸï¼‰ - æ—¥æœ¬ã‚·ãƒªãƒ¼ã‚º',
                        matches: [
                            { home: 'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯', away: 'é˜ªç¥', homeScore: 1, awayScore: 2, stadium: 'PayPayãƒ‰ãƒ¼ãƒ ', type: 'JS' }
                        ]
                    }
                ],
                scrapedAt: new Date().toISOString()
            };

            addLog('âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†ï¼ˆJSONã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ï¼‰', 'success');
            updateProgress(100, 'å®Œäº†');
            await new Promise(resolve => setTimeout(resolve, 500));

            scrapeCount++;
            document.getElementById('scrapeCount').textContent = scrapeCount;

            return scrapedData;
        }

        // ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ¡ã‚¤ãƒ³é–¢æ•°
        async function fetchData() {
            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.disabled = true;
            requestCount++;
            
            addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            addLog(`ğŸš€ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #${requestCount} ã‚’å—ä¿¡`, 'info');
            
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
            if (checkCache()) {
                addLog('âœ¨ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼ æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã—ã¾ã™', 'success');
                addLog(`ğŸ“¦ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™: ${new Date(cacheExpiry).toLocaleString('ja-JP')}`, 'info');
                addLog('âš¡ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚µãƒ¼ãƒãƒ¼è² è·ã‚¼ãƒ­ï¼‰', 'success');
                
                cacheHits++;
                document.getElementById('cacheHits').textContent = cacheHits;
                
                displayData(cacheData, true);
                fetchBtn.disabled = false;
                updateStats();
                return;
            }
            
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹
            addLog('âš ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ï¼ æ–°è¦ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå¿…è¦ã§ã™', 'warning');
            cacheMisses++;
            document.getElementById('cacheMisses').textContent = cacheMisses;
            
            addLog(`â±ï¸ ${SCRAPING_DELAY/1000}ç§’ã®é…å»¶ã‚’é–‹å§‹ï¼ˆé€£ç¶šã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ï¼‰`, 'warning');
            addLog('ğŸ›¡ï¸ NPBå…¬å¼ã‚µã‚¤ãƒˆã¸ã®è² è·è»½æ¸›æªç½®ã‚’å®Ÿæ–½ä¸­...', 'info');
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
            await showCountdown();
            
            // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ
            addLog('ğŸ”§ Vercel Serverless Function ã‚’èµ·å‹•', 'info');
            addLog('User-Agent: NPB-Live-Dashboard/1.0 (Educational Purpose)', 'info');
            
            try {
                const data = await scrapeNPBData();
                
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
                cacheData = data;
                cacheExpiry = Date.now() + CACHE_DURATION;
                lastFetchTime = Date.now();
                
                addLog(`ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜å®Œäº†ï¼ˆæœ‰åŠ¹æœŸé™: 3åˆ†ï¼‰`, 'success');
                addLog(`ğŸ“Š æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«è¿”å´ã•ã‚Œã¾ã™`, 'info');
                
                displayData(data, false);
                updateStats();
                
            } catch (error) {
                addLog(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, 'error');
                document.getElementById('dataContainer').innerHTML = `
                    <p style="color: red; text-align: center; padding: 40px;">
                        ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}
                    </p>
                `;
            }
            
            fetchBtn.disabled = false;
        }

        // ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        function displayData(data, fromCache) {
            const dataContainer = document.getElementById('dataContainer');
            const badgeClass = fromCache ? 'cache-hit' : 'cache-miss';
            const badgeText = fromCache ? 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—' : 'æ–°è¦ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°';
            
            let html = `
                <div style="text-align: right; margin-bottom: 20px;">
                    <span class="badge ${badgeClass}">${badgeText}</span>
                </div>
            `;
            
            data.games.forEach(day => {
                html += `<h3 style="color: #667eea; margin: 25px 0 15px 0;">${day.date}</h3>`;
                day.matches.forEach(match => {
                    const winner = match.homeScore > match.awayScore ? 'home' : 'away';
                    const matchType = match.type === 'CS' ? ' ğŸ† ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º' : 
                                     match.type === 'JS' ? ' ğŸ–ï¸ æ—¥æœ¬ã‚·ãƒªãƒ¼ã‚º' : '';
                    
                    html += `
                        <div class="game-card">
                            <div class="game-date">ğŸ“ ${match.stadium}${matchType}</div>
                            <div class="game-score">
                                <span class="team-away ${winner === 'away' ? 'winner' : ''}">${match.away}</span>
                                <span style="color: #999; margin: 0 15px;">${match.awayScore} - ${match.homeScore}</span>
                                <span class="team-home ${winner === 'home' ? 'winner' : ''}">${match.home}</span>
                            </div>
                        </div>
                    `;
                });
            });
            
            html += `
                <div style="margin-top: 30px; padding: 20px; background: #f0f4ff; border-radius: 10px;">
                    <p style="font-size: 0.85em; color: #666; line-height: 1.8;">
                        <strong>ğŸ“Š ãƒ‡ãƒ¼ã‚¿å‡ºå…¸:</strong> NPBå…¬å¼ã‚µã‚¤ãƒˆ (https://npb.jp/)<br>
                        <strong>â° å–å¾—æ—¥æ™‚:</strong> ${new Date(data.scrapedAt).toLocaleString('ja-JP')}<br>
                        <strong>ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ–¹å¼:</strong> Vercel Edge Cache ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ3åˆ†é–“æœ‰åŠ¹ï¼‰
                    </p>
                </div>
            `;
            
            dataContainer.innerHTML = html;
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            if (lastFetchTime) {
                document.getElementById('lastFetch').textContent = new Date(lastFetchTime).toLocaleString('ja-JP');
            }
            
            if (cacheExpiry) {
                const remaining = Math.max(0, Math.floor((cacheExpiry - Date.now()) / 1000));
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                document.getElementById('cacheExpiry').textContent = 
                    `${minutes}åˆ†${seconds}ç§’å¾Œï¼ˆ${new Date(cacheExpiry).toLocaleTimeString('ja-JP')}ï¼‰`;
            }
            
            const hitRate = requestCount > 0 ? Math.round((cacheHits / requestCount) * 100) : 0;
            document.getElementById('hitRate').textContent = `${hitRate}%`;
            document.getElementById('requestCount').textContent = `${requestCount}å›`;
        }

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
        function clearCache() {
            cacheData = null;
            cacheExpiry = null;
            addLog('ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'warning');
            addLog('æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯æ–°è¦ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™', 'info');
            document.getElementById('cacheExpiry').textContent = 'ãªã—';
            updateStats();
        }

        // çµ±è¨ˆæƒ…å ±ã‚’1ç§’ã”ã¨ã«æ›´æ–°
        setInterval(updateStats, 1000);

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ­ã‚°
        window.addEventListener('load', () => {
            addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
            addLog('ğŸ‰ NPB Live Dashboard åˆæœŸåŒ–å®Œäº†', 'success');
            addLog('ğŸ“‹ ä¼ç”»æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0', 'info');
            addLog('âš™ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™: 3åˆ†ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰', 'info');
            addLog('â±ï¸ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é…å»¶: 5ç§’', 'info');
            addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
        });
    </script>
</body>
</html>
